<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - Uptime Monitor</title>
    <!-- Favicon: ç›¾ç‰Œ SVG -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ğŸ›¡ï¸</text></svg>">
    <script src="https://cdn.bootcdn.net/ajax/libs/vue/3.3.4/vue.global.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        .font-mono { font-family: 'JetBrains Mono', monospace; }
        
        /* ç£¨ç ‚ç»ç’ƒæ•ˆæœ */
        .glass {
            background: rgba(255, 255, 255, 0.7);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        .dark .glass {
            background: rgba(15, 23, 42, 0.7);
            border: 1px solid rgba(255, 255, 255, 0.05);
        }

        /* è¾“å…¥æ¡†èšç„¦åŠ¨ç”» */
        .input-transition {
            transition: all 0.2s ease-in-out;
        }
        .input-transition:focus {
            transform: translateY(-1px);
            box-shadow: 0 4px 6px -1px rgba(59, 130, 246, 0.1), 0 2px 4px -1px rgba(59, 130, 246, 0.06);
        }

        /* è‡ªå®šä¹‰æ»šåŠ¨æ¡ */
        ::-webkit-scrollbar {
            width: 6px;
            height: 6px;
        }
        ::-webkit-scrollbar-track {
            background: transparent;
        }
        ::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 3px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #94a3b8;
        }
        /* Dark mode (media query support for raw css is tricky without class, but we can use specific selectors if dark class is present on html/body) */
        @media (prefers-color-scheme: dark) {
            ::-webkit-scrollbar-thumb {
                background: #334155;
            }
            ::-webkit-scrollbar-thumb:hover {
                background: #475569;
            }
        }
    </style>
    <script>
        tailwind.config = {
            darkMode: 'media', // è·Ÿéšç³»ç»Ÿï¼Œä¹Ÿå¯ä»¥æ”¹ä¸º 'class' æ‰‹åŠ¨åˆ‡æ¢
            theme: {
                extend: {
                    colors: {
                        primary: '#3b82f6',
                        dark: '#0f172a',
                        'dark-card': '#1e293b'
                    }
                }
            }
        }
    </script>
</head>
<body class="bg-gray-50 text-slate-800 dark:bg-slate-900 dark:text-slate-200 min-h-screen transition-colors duration-300">
    <div id="app" class="min-h-screen flex flex-col">
        
        <!-- ç™»å½•å¼¹çª— (å…¨å±è¦†ç›–) -->
        <transition enter-active-class="transition duration-300 ease-out" enter-from-class="opacity-0 scale-95" enter-to-class="opacity-100 scale-100" leave-active-class="transition duration-200 ease-in" leave-from-class="opacity-100 scale-100" leave-to-class="opacity-0 scale-95">
            <div v-if="!isAuthenticated" class="fixed inset-0 z-50 flex items-center justify-center p-4 bg-slate-900/50 backdrop-blur-sm">
                <div class="bg-white dark:bg-slate-800 w-full max-w-md rounded-2xl shadow-2xl overflow-hidden border border-gray-100 dark:border-slate-700">
                    <div class="p-8 text-center">
                        <div class="w-16 h-16 bg-blue-50 dark:bg-blue-900/30 rounded-full flex items-center justify-center mx-auto mb-6">
                            <i class="fas fa-lock text-2xl text-blue-600 dark:text-blue-400"></i>
                        </div>
                        <h2 class="text-2xl font-bold text-gray-900 dark:text-white mb-2">Admin Access</h2>
                        <p class="text-gray-500 dark:text-slate-400 mb-8 text-sm">è¯·è¾“å…¥ç®¡ç†å‘˜å¯†ç ä»¥è®¿é—®æ§åˆ¶å°</p>
                        
                        <div class="relative group">
                            <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                <i class="fas fa-key text-gray-400 group-focus-within:text-blue-500 transition-colors"></i>
                            </div>
                            <input type="password" v-model="inputPassword" @keyup.enter="login" 
                                class="block w-full pl-10 pr-3 py-3 border border-gray-200 dark:border-slate-600 rounded-xl leading-5 bg-gray-50 dark:bg-slate-900 text-gray-900 dark:text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 sm:text-sm transition-all duration-200 shadow-sm hover:bg-white dark:hover:bg-slate-800" 
                                placeholder="Enter your password" autocomplete="current-password">
                        </div>

                        <button @click="login" class="mt-6 w-full flex justify-center py-3 px-4 border border-transparent rounded-xl shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-all duration-200 hover:shadow-lg hover:-translate-y-0.5 active:translate-y-0">
                            è¿›å…¥ç³»ç»Ÿ
                        </button>
                    </div>
                    <div class="bg-gray-50 dark:bg-slate-900/50 px-8 py-4 border-t border-gray-100 dark:border-slate-700 flex justify-between items-center text-xs text-gray-400">
                        <span><i class="fas fa-shield-alt mr-1"></i> Secure Area</span>
                        <a href="/" class="hover:text-blue-600 transition-colors">è¿”å›é¦–é¡µ</a>
                    </div>
                </div>
            </div>
        </transition>

        <!-- é¡¶éƒ¨å¯¼èˆª -->
        <header class="bg-white dark:bg-slate-800 border-b border-gray-200 dark:border-slate-700 sticky top-0 z-40 shadow-sm backdrop-blur-md bg-opacity-80 dark:bg-opacity-80">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex justify-between h-16">
                    <div class="flex items-center">
                        <div class="flex-shrink-0 flex items-center gap-2">
                            <div class="w-8 h-8 bg-blue-600 rounded-lg flex items-center justify-center text-white">
                                <i class="fas fa-bolt"></i>
                            </div>
                            <span class="font-bold text-xl tracking-tight text-gray-900 dark:text-white">Uptime<span class="text-blue-600">.Admin</span></span>
                        </div>
                    </div>
                    <div class="flex items-center gap-4">
                        <a href="/" class="p-2 rounded-lg text-gray-400 hover:text-blue-600 hover:bg-blue-50 dark:hover:bg-slate-700 transition-colors" title="æŸ¥çœ‹çŠ¶æ€é¡µ">
                            <i class="fas fa-external-link-alt"></i>
                        </a>
                        <button @click="fetchMonitors" class="p-2 rounded-lg text-gray-400 hover:text-blue-600 hover:bg-blue-50 dark:hover:bg-slate-700 transition-colors" :class="{ 'animate-spin': loading }" title="åˆ·æ–°æ•°æ®">
                            <i class="fas fa-sync-alt"></i>
                        </button>
                        <div class="h-6 w-px bg-gray-200 dark:bg-slate-700 mx-1"></div>
                        <button @click="logout" class="flex items-center gap-2 px-3 py-2 rounded-lg text-sm font-medium text-gray-600 dark:text-slate-300 hover:bg-red-50 hover:text-red-600 dark:hover:bg-red-900/20 dark:hover:text-red-400 transition-colors">
                            <i class="fas fa-sign-out-alt"></i>
                            <span class="hidden sm:inline">é€€å‡º</span>
                        </button>
                    </div>
                </div>
            </div>
        </header>

        <!-- ä¸»è¦å†…å®¹ -->
        <main class="flex-1 max-w-7xl w-full mx-auto px-4 sm:px-6 lg:px-8 py-8">
            
            <!-- æ·»åŠ ç›‘æ§å¡ç‰‡ -->
            <div class="bg-white dark:bg-slate-800 rounded-2xl shadow-sm border border-gray-100 dark:border-slate-700 mb-8 overflow-hidden">
                <div class="px-6 py-4 border-b border-gray-100 dark:border-slate-700 bg-gray-50/50 dark:bg-slate-800/50 flex justify-between items-center">
                    <h3 class="text-lg font-semibold text-gray-900 dark:text-white flex items-center gap-2">
                        <i class="fas fa-plus-circle text-blue-500"></i> æ·»åŠ æ–°ç›‘æ§
                    </h3>
                    <span class="text-xs font-mono text-gray-400 bg-gray-100 dark:bg-slate-700 px-2 py-1 rounded">HTTPS / HTTP</span>
                </div>
                <div class="p-6">
                    <div class="grid grid-cols-1 md:grid-cols-12 gap-4">
                        <div class="md:col-span-4">
                            <label class="block text-xs font-medium text-gray-500 dark:text-slate-400 mb-1">ç½‘ç«™åç§°</label>
                            <input v-model="newMonitor.name" placeholder="ä¾‹å¦‚: Google Search" class="input-transition w-full border border-gray-200 dark:border-slate-600 rounded-lg px-4 py-2.5 dark:bg-slate-900 dark:text-white focus:border-blue-500 focus:ring-2 focus:ring-blue-200 dark:focus:ring-blue-900 outline-none">
                        </div>
                        <div class="md:col-span-8">
                            <label class="block text-xs font-medium text-gray-500 dark:text-slate-400 mb-1">URL åœ°å€</label>
                            <div class="relative">
                                <span class="absolute inset-y-0 left-0 pl-3 flex items-center text-gray-400">
                                    <i class="fas fa-link text-xs"></i>
                                </span>
                                <input v-model="newMonitor.url" placeholder="https://example.com" class="input-transition w-full border border-gray-200 dark:border-slate-600 rounded-lg pl-9 pr-4 py-2.5 dark:bg-slate-900 dark:text-white focus:border-blue-500 focus:ring-2 focus:ring-blue-200 dark:focus:ring-blue-900 outline-none font-mono text-sm">
                            </div>
                        </div>
                        <div class="md:col-span-4">
                            <label class="block text-xs font-medium text-gray-500 dark:text-slate-400 mb-1">å…³é”®è¯éªŒè¯ (å¯é€‰)</label>
                            <input v-model="newMonitor.keyword" placeholder="é¡µé¢å¿…é¡»åŒ…å«çš„å†…å®¹" class="input-transition w-full border border-gray-200 dark:border-slate-600 rounded-lg px-4 py-2.5 dark:bg-slate-900 dark:text-white focus:border-blue-500 focus:ring-2 focus:ring-blue-200 dark:focus:ring-blue-900 outline-none">
                        </div>
                        <div class="md:col-span-5">
                            <label class="block text-xs font-medium text-gray-500 dark:text-slate-400 mb-1">User-Agent (å¯é€‰)</label>
                            <input v-model="newMonitor.user_agent" placeholder="é»˜è®¤: Uptime-Monitor/1.0" class="input-transition w-full border border-gray-200 dark:border-slate-600 rounded-lg px-4 py-2.5 dark:bg-slate-900 dark:text-white focus:border-blue-500 focus:ring-2 focus:ring-blue-200 dark:focus:ring-blue-900 outline-none font-mono text-xs">
                        </div>
                        <div class="md:col-span-3 flex items-end">
                            <button @click="addMonitor" :disabled="submitting" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-medium py-2.5 rounded-lg transition-all shadow-sm hover:shadow-md disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2">
                                <i v-if="submitting" class="fas fa-spinner fa-spin"></i>
                                <i v-else class="fas fa-paper-plane"></i>
                                {{ submitting ? 'æ·»åŠ ä¸­...' : 'å¼€å§‹ç›‘æ§' }}
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ç›‘æ§åˆ—è¡¨ -->
            <div v-if="monitors.length === 0" class="text-center py-20 bg-white dark:bg-slate-800 rounded-2xl border border-dashed border-gray-200 dark:border-slate-700">
                <div class="w-20 h-20 bg-gray-50 dark:bg-slate-700 rounded-full flex items-center justify-center mx-auto mb-4">
                    <i class="fas fa-server text-3xl text-gray-300 dark:text-slate-500"></i>
                </div>
                <h3 class="text-lg font-medium text-gray-900 dark:text-white">æš‚æ— ç›‘æ§é¡¹ç›®</h3>
                <p class="text-gray-500 dark:text-slate-400 mt-1">åœ¨ä¸Šæ–¹æ·»åŠ æ‚¨çš„ç¬¬ä¸€ä¸ªç½‘ç«™ç›‘æ§</p>
            </div>

            <div v-else class="grid gap-4">
                <div v-for="m in monitors" :key="m.id" class="group bg-white dark:bg-slate-800 p-5 rounded-xl shadow-sm hover:shadow-md border border-gray-100 dark:border-slate-700 transition-all duration-200 flex flex-col md:flex-row items-center justify-between gap-6">
                    
                    <!-- å·¦ä¾§ä¿¡æ¯ -->
                    <div class="flex items-start gap-4 w-full md:w-auto">
                        <div class="flex-shrink-0 mt-1">
                            <span class="relative flex h-3 w-3">
                              <span v-if="m.status === 'UP'" class="animate-ping absolute inline-flex h-full w-full rounded-full bg-green-400 opacity-75"></span>
                              <span class="relative inline-flex rounded-full h-3 w-3" :class="m.status === 'UP' ? 'bg-green-500' : 'bg-red-500'"></span>
                            </span>
                        </div>
                        <div class="flex-1 min-w-0">
                            <div class="flex items-center gap-2 mb-1">
                                <h3 class="text-lg font-bold text-gray-900 dark:text-white truncate">{{ m.name }}</h3>
                                <span v-if="m.status !== 'UP'" class="px-2 py-0.5 rounded text-xs font-bold bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-400 animate-pulse">DOWN</span>
                            </div>
                            <a :href="m.url" target="_blank" class="text-sm text-gray-500 dark:text-slate-400 hover:text-blue-600 dark:hover:text-blue-400 font-mono flex items-center gap-1 truncate">
                                {{ m.url }} <i class="fas fa-external-link-alt text-[10px] opacity-50"></i>
                            </a>
                            <div v-if="m.keyword" class="mt-1 text-xs text-gray-400 flex items-center gap-1">
                                <i class="fas fa-filter text-[10px]"></i> å…³é”®è¯: {{ m.keyword }}
                            </div>
                        </div>
                    </div>

                    <!-- å³ä¾§çŠ¶æ€ä¸æ“ä½œ -->
                    <div class="flex flex-col md:flex-row items-center gap-4 md:gap-8 w-full md:w-auto border-t md:border-t-0 border-gray-100 dark:border-slate-700 pt-4 md:pt-0">
                        
                        <!-- æŒ‡æ ‡æ•°æ® -->
                        <div class="grid grid-cols-3 md:flex md:items-center gap-4 md:gap-6 text-center md:text-right w-full md:w-auto">
                            <div class="flex flex-col">
                                <span class="text-[10px] uppercase tracking-wider text-gray-400 font-bold">Last Check</span>
                                <span class="text-xs font-mono text-gray-600 dark:text-slate-300">{{ formatDate(m.last_check) }}</span>
                            </div>
                            <div class="flex flex-col">
                                <span class="text-[10px] uppercase tracking-wider text-gray-400 font-bold">SSL</span>
                                <span class="text-xs font-mono font-medium" :class="getExpiryClass(m.cert_expiry)">
                                    {{ m.cert_expiry ? getDaysRemaining(m.cert_expiry) + 'd' : 'OK' }}
                                </span>
                            </div>
                            <div class="flex flex-col">
                                <span class="text-[10px] uppercase tracking-wider text-gray-400 font-bold">Domain</span>
                                <span class="text-xs font-mono font-medium" :class="getExpiryClass(m.domain_expiry)">
                                    {{ m.domain_expiry ? getDaysRemaining(m.domain_expiry) + 'd' : '-' }}
                                </span>
                            </div>
                        </div>

                        <!-- æ“ä½œæŒ‰é’® -->
                        <div class="flex items-center gap-2 w-full md:w-auto justify-end">
                            <button @click="viewLogs(m)" class="p-2 text-gray-400 hover:text-blue-600 hover:bg-blue-50 dark:hover:bg-blue-900/20 rounded-lg transition-colors" title="æ—¥å¿—">
                                <i class="fas fa-list-ul"></i>
                            </button>
                            <button @click="deleteMonitor(m.id)" class="p-2 text-gray-400 hover:text-red-600 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg transition-colors" title="åˆ é™¤">
                                <i class="far fa-trash-alt"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </main>

        <!-- åº•éƒ¨ç‰ˆæƒ -->
        <footer class="mt-auto py-6 border-t border-gray-200 dark:border-slate-800 bg-white dark:bg-slate-800/50 backdrop-blur-sm">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 flex flex-col md:flex-row justify-between items-center gap-4">
                <p class="text-xs text-gray-400 dark:text-slate-500">
                    &copy; {{ new Date().getFullYear() }} <a href="https://nianshu2022.cn" target="_blank" class="hover:text-blue-600 dark:hover:text-blue-400 transition-colors font-medium">å¿µèˆ’</a>. All Rights Reserved.
                </p>
                <div class="flex items-center gap-4 text-xs text-gray-400 dark:text-slate-600 font-mono">
                    <span><i class="fas fa-code-branch mr-1"></i>v1.2.0</span>
                    <span><i class="fas fa-server mr-1"></i>Cloudflare Edge</span>
                </div>
            </div>
        </footer>

        <!-- æ—¥å¿—æ¨¡æ€æ¡† (ä¾§è¾¹æŠ½å±‰å¼) -->
        <transition enter-active-class="transition transform duration-300 ease-in-out" enter-from-class="translate-x-full" enter-to-class="translate-x-0" leave-active-class="transition transform duration-300 ease-in-out" leave-from-class="translate-x-0" leave-to-class="translate-x-full">
            <div v-if="showLogs" class="fixed inset-y-0 right-0 w-full max-w-2xl bg-white dark:bg-slate-800 shadow-2xl z-50 border-l border-gray-200 dark:border-slate-700 flex flex-col">
                <div class="px-6 py-4 border-b border-gray-200 dark:border-slate-700 flex justify-between items-center bg-gray-50 dark:bg-slate-900">
                    <div>
                        <h3 class="text-lg font-bold text-gray-900 dark:text-white">{{ currentMonitor?.name }}</h3>
                        <p class="text-xs text-gray-500 font-mono mt-1">æ£€æµ‹æ—¥å¿—æµæ°´</p>
                    </div>
                    <button @click="showLogs = false" class="text-gray-400 hover:text-gray-600 dark:hover:text-slate-300 transition">
                        <i class="fas fa-times text-xl"></i>
                    </button>
                </div>
                <div class="flex-1 overflow-y-auto p-0">
                    <table class="w-full text-left border-collapse">
                        <thead class="bg-gray-50 dark:bg-slate-900/50 sticky top-0 z-10">
                            <tr>
                                <th class="px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider border-b dark:border-slate-700">Time</th>
                                <th class="px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider border-b dark:border-slate-700">Status</th>
                                <th class="px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider border-b dark:border-slate-700">Latency</th>
                                <th class="px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider border-b dark:border-slate-700">Result</th>
                            </tr>
                        </thead>
                        <tbody class="divide-y divide-gray-100 dark:divide-slate-700">
                            <tr v-for="log in logs" :key="log.id" class="hover:bg-gray-50 dark:hover:bg-slate-700/50 transition">
                                <td class="px-6 py-3 text-xs text-gray-500 dark:text-slate-400 whitespace-nowrap">{{ formatDate(log.created_at) }}</td>
                                <td class="px-6 py-3 text-xs font-mono">
                                    <span :class="log.status_code >= 200 && log.status_code < 300 ? 'text-green-600' : 'text-red-600'">{{ log.status_code || '-' }}</span>
                                </td>
                                <td class="px-6 py-3 text-xs font-mono text-gray-500 dark:text-slate-400">{{ log.latency }}ms</td>
                                <td class="px-6 py-3 text-xs">
                                    <span v-if="log.is_fail" class="inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-red-100 text-red-800 dark:bg-red-900/20 dark:text-red-400">
                                        {{ log.reason || 'Failed' }}
                                    </span>
                                    <span v-else class="inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-green-100 text-green-800 dark:bg-green-900/20 dark:text-green-400">
                                        Normal
                                    </span>
                                </td>
                            </tr>
                            <tr v-if="logs.length === 0">
                                <td colspan="4" class="px-6 py-12 text-center text-gray-400 dark:text-slate-500">æš‚æ— æ—¥å¿—è®°å½•</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </transition>
        <!-- é®ç½©å±‚ (ç‚¹å‡»å…³é—­æ—¥å¿—) -->
        <div v-if="showLogs" @click="showLogs = false" class="fixed inset-0 bg-black/50 backdrop-blur-sm z-40 transition-opacity"></div>

    </div>

    <script>
        // ä½ çš„ Worker åœ°å€
        const API_BASE = 'https://uptime-api.nianshu2022.cn';

        const { createApp, ref, onMounted, computed } = Vue;

        createApp({
            setup() {
                const monitors = ref([]);
                const logs = ref([]);
                const showLogs = ref(false);
                const currentMonitor = ref(null);
                const newMonitor = ref({ name: '', url: '', keyword: '', user_agent: '' });
                const loading = ref(false);
                const submitting = ref(false);
                
                const inputPassword = ref('');
                const storedPassword = ref(sessionStorage.getItem('uptime_admin_password'));
                const isAuthenticated = computed(() => {
                    return storedPassword.value && storedPassword.value.length > 0;
                });

                // å°è£…å¸¦ Auth çš„ fetch
                const authFetch = async (url, options = {}) => {
                    const headers = {
                        ...options.headers,
                        'Authorization': `Bearer ${storedPassword.value}`
                    };
                    const res = await fetch(url, { ...options, headers });
                    if (res.status === 401) {
                        console.log('401 received, clearing password');
                        storedPassword.value = '';
                        sessionStorage.removeItem('uptime_admin_password');
                        location.reload();
                    }
                    return res;
                };

                const login = () => {
                    if (!inputPassword.value) return;
                    storedPassword.value = inputPassword.value;
                    sessionStorage.setItem('uptime_admin_password', inputPassword.value);
                    fetchMonitors();
                };

                const logout = () => {
                    // å…ˆè·³è½¬ï¼Œåˆ©ç”¨æµè§ˆå™¨çš„è¡Œä¸ºæ¥é”€æ¯é¡µé¢
                    sessionStorage.removeItem('uptime_admin_password');
                    window.location.href = '/';
                };

                const fetchMonitors = async () => {
                    if (!isAuthenticated.value) return;
                    loading.value = true;
                    try {
                        const res = await authFetch(`${API_BASE}/monitors`);
                        if (res && res.ok) {
                            monitors.value = await res.json();
                        }
                    } catch (e) {
                        console.error('Fetch error:', e);
                    } finally {
                        loading.value = false;
                    }
                };

                const addMonitor = async () => {
                    if (!newMonitor.value.name || !newMonitor.value.url) return;
                    submitting.value = true;
                    try {
                        const res = await authFetch(`${API_BASE}/monitors`, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify(newMonitor.value)
                        });
                        if (res.ok) {
                            newMonitor.value = { name: '', url: '', keyword: '', user_agent: '' };
                            fetchMonitors();
                        } else {
                            const data = await res.json();
                            alert(data.error || 'æ·»åŠ å¤±è´¥ï¼Œè¯·æ£€æŸ¥è¾“å…¥');
                        }
                    } catch (e) {
                        alert('ç½‘ç»œé”™è¯¯');
                    } finally {
                        submitting.value = false;
                    }
                };

                const deleteMonitor = async (id) => {
                    if (!confirm('ç¡®å®šè¦åˆ é™¤è¿™ä¸ªç›‘æ§é¡¹å—ï¼Ÿå†å²æ—¥å¿—ä¹Ÿä¼šè¢«åˆ é™¤ã€‚')) return;
                    try {
                        const res = await authFetch(`${API_BASE}/monitors/${id}`, { method: 'DELETE' });
                        if (res.ok) {
                            fetchMonitors();
                        } else {
                            const data = await res.json();
                            alert(data.error || 'åˆ é™¤å¤±è´¥');
                        }
                    } catch (e) {
                        alert('ç½‘ç»œé”™è¯¯');
                    }
                };

                const viewLogs = async (monitor) => {
                    currentMonitor.value = monitor;
                    logs.value = [];
                    showLogs.value = true;
                    try {
                        const res = await authFetch(`${API_BASE}/monitors/${monitor.id}/logs`);
                        if (res.ok) {
                            logs.value = await res.json();
                        }
                    } catch (e) {
                        console.error(e);
                    }
                };

                const formatDate = (str) => {
                    if (!str) return '-';
                    let dateStr = str;
                    if (typeof str === 'string' && !str.includes('Z') && !str.includes('+') && !str.includes('T')) {
                        dateStr = str.replace(' ', 'T') + 'Z';
                    } else if (typeof str === 'string' && !str.includes('Z') && !str.includes('+')) {
                        dateStr = str + 'Z';
                    }
                    
                    const date = new Date(dateStr);
                    return date.toLocaleString('zh-CN', {
                        timeZone: 'Asia/Shanghai',
                        month: '2-digit', day: '2-digit', 
                        hour: '2-digit', minute: '2-digit', second: '2-digit',
                        hour12: false
                    });
                };

                const getDaysRemaining = (dateStr) => {
                    if (!dateStr) return '-';
                    const diff = new Date(dateStr).getTime() - Date.now();
                    return Math.ceil(diff / (1000 * 60 * 60 * 24));
                };

                const getExpiryClass = (dateStr) => {
                    if (!dateStr) return 'text-green-600 dark:text-green-400'; // OK
                    const days = getDaysRemaining(dateStr);
                    if (days < 7) return 'text-red-600 dark:text-red-400 font-bold';
                    if (days < 30) return 'text-yellow-600 dark:text-yellow-400';
                    return 'text-green-600 dark:text-green-400';
                };

                onMounted(() => {
                    if (isAuthenticated.value) {
                        fetchMonitors();
                    }
                });

                return { 
                    monitors, newMonitor, logs, showLogs, currentMonitor, 
                    loading, submitting, inputPassword, isAuthenticated,
                    login, logout,
                    addMonitor, deleteMonitor, viewLogs, fetchMonitors, 
                    formatDate, getDaysRemaining, getExpiryClass 
                };
            }
        }).mount('#app');
    </script>
</body>
</html>